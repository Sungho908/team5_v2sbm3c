<!DOCTYPE html>

<html layout:decorate="~{layout}" xmlns:th="www.thymeleaf.org">
<!-- layout.html 상속-->

<div layout:fragment="content">
<<<<<<< Updated upstream


  <body>
    <script src="/js/basket.js"></script>
    <div class="detail_container">
      <span th:if="${not #strings.isEmpty(session.login)}">
        <input type="hidden" id="mymemberno" th:data-mymemberno="${memberno}">
      </span>
      <input type="hidden" id="shoesno" th:data-shoesno="${shoesAllVO.shoesVO.shoesno}">
=======
  <style type="text/css">
    .optionDiv{
      width: max-content;
      margin: 0px auto;
    }
    .optionDiv::after{
      content: '';
      display: block;
      clear: both;
    }
  </style>
  <script src="/js/basket.js"></script>
  <div class="detail_container">
    <span th:if="${not #strings.isEmpty(session.login)}">
      <input type="hidden" id="memberno" th:data-memberno="|${session.login.memberno}|">
    </span>
    <input type="hidden" id="mymemberno" th:data-mymemberno="${memberno}">
    <input type="hidden" id="shoesno" th:data-shoesno="${shoesAllVO.shoesVO.shoesno}">


    <h1 class="title" th:text="${shoesAllVO.shoesVO.title}"></h1>
    <div id="wrap" class="product">
      <img src="/images/nike.jpg" alt="스니커즈1">
      <div class="content">
        <p>상품 설명 </p>
        <p>가격:<span id="price" th:text="${shoesAllVO.shoesVO.price}"></span></p>
      </div>
      <div class="content">
        <!--
        <h3 for="sizes" style="text-align: center;">SIZE</h3>
        <p style="text-align: center; text-align: center;">[필수] 옵션을 선택해주세요</p>

        <select name="sizes" id="sizes" class="form-control form-control-sm"
          style="width: 50%; margin: 0 auto; margin-top: 20px; margin-bottom: 20px; text-align: center; ">
          <option value="">사이즈를 선택하세요</option>
          <option th:each="size : ${sizes}" th:value="${size}" th:text="${size}"></option>
        </select>
        <br>
        <h3 for="sizes" style="text-align: center;">색상</h3>
        <p style="text-align: center; text-align: center;">[필수] 옵션을 선택해주세요</p>

        <select name="color" id="color" class="form-control form-control-sm"
          style="width: 50%; margin: 0 auto; margin-top: 20px; margin-bottom: 20px; text-align: center;">
          <option value="">사이즈를 선택하세요</option>
          <option th:each="color : ${color}" th:value="${color}" th:text="${color}"></option>
        </select>
        -->

        <!--/* ■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■*/-->



        <h2>옵션 선택</h2>
        <div class="optionDiv">
          <select style="width: 300px; height: 3rem; float: left;" id="optionSelect">
            <option selected>옵션을 선택해주세요.</option>
            <option th:each="option :${options}" th:disabled="${option.amount <= 0}" th:value="${option.optionno}">
              <th:block th:utext="${@StringUtils.formatnbsp(
                                   optionStat.count + '.    ' + 
                                   '크기: ' + option.sizes + '    ' +
                                   '색상: ' + option.color + '    ' +
                                   '남은 수량: ' + option.amount + '개')}">
              </th:block>
            </option>
          </select>
          <div style="border: 1px solid black; float: right; height: 3rem; background-color: #ddd;">수량선택
            <input style="width: 50px; height: 2.9rem; border: 0px;" type="number" id="amountInput" min="1" disabled>
          </div>
        </div>

>>>>>>> Stashed changes

      <h1 class="title" th:text="${shoesAllVO.shoesVO.title}"></h1>
      <div id="wrap" class="product">
        <img src="/images/nike.jpg" alt="스니커즈1">
        <div class="content">
<<<<<<< Updated upstream
          <p>상품 설명 </p>
          <p>가격:</p>
=======
          <button class="detail_btnl">장바구니</button>
          <button class="detail_btnr" onclick="send()">바로구매하기</button>
>>>>>>> Stashed changes
        </div>
        <div class="content">
          <h3 for="sizes" style="text-align: center;">SIZE</h3>
          <p style="text-align: center; text-align: center;">[필수] 옵션을 선택해주세요</p>

          <select name="sizes" id="sizes" class="form-control form-control-sm"
            style="width: 50%; margin: 0 auto; margin-top: 20px; margin-bottom: 20px; text-align: center; ">
            <option value="">사이즈를 선택하세요</option>
          </select>
          <br>
          <h3 for="sizes" style="text-align: center;">색상</h3>
          <p style="text-align: center; text-align: center;">[필수] 옵션을 선택해주세요</p>

          <select name="color" id="color" class="form-control form-control-sm"
            style="width: 50%; margin: 0 auto; margin-top: 20px; margin-bottom: 20px; text-align: center;">
            <option value="">색상을 선택하세요</option>
            <option th:each="color : ${color}" th:value="${color}" th:text="${color}"></option>
          </select>

          <div class="content">
            <button class="detail_btnl">장바구니</button>
            <button class="detail_btnr" onclick="send()">구매하기</button>
          </div>

        </div>
      </div>

      <div th:replace="~{review/review_component::review_fragment}"></div>
      <div th:replace="~{report/report_component::report_fragment}"></div>

      <!-- 후기 답글 -->
      <div class="widget_item_comment_container">
        <div class="widget_answer_img"></div>
        <div class="widget_item_comment_content">
          <p>내용<br></p>
          <div class="widget_item_comment_content_1">운영자</div>
        </div>
      </div>
      <div class="between_line"></div>
      <!-- 후기 답글 끝-->

<<<<<<< Updated upstream
    </div>
=======
  </div>
  <script th:inline="javascript">
    let options = /*[[${options}]]*/"";
    
    let optionSelect = document.getElementById('optionSelect');
    let amountInput = document.getElementById('amountInput');
    
    
    optionSelect.addEventListener('change', function () {
      let selectedValue = this.value;
      let selectedOption = options.find(option => option.optionno == selectedValue);
      if (selectedOption) {
        amountInput.disabled = false;
        amountInput.max = selectedOption.amount;
      }else{
        amountInput.disabled = true;
        amountInput.value = null;
      }
    });
    
    amountInput.addEventListener('keyup', function(){
      
      if(parseInt(amountInput.value) > parseInt(amountInput.max)){
        amountInput.value = amountInput.max;
      }
      
      if(parseInt(amountInput.value) <= parseInt(amountInput.min)){
        amountInput.value = amountInput.min;
      }
      
    });


    function send() {
      let memberno = /*[[${session.login != null ? session.login.memberno : null}]]*/"";
      let price = document.getElementById("price").innerText;
      
      let amountInput = document.getElementById('amountInput'); 
      let optionSelect = document.getElementById('optionSelect');
      let selected = optionSelect.options[optionSelect.selectedIndex].value; 
      if (amountInput.value == null || amountInput.value == 0 || (amountInput.value > amountInput.max) ) {
        amountInput.focus();
        return false;
      }
      if(memberno == null || memberno == ""){
        alert("로그인 후 구매하실 수 있습니다.");
        return false;
      }
      
      fetch(window.location.pathname + '/payment',{
        method: 'POST',
        headers:{
          'Content-Type': 'application/json',
          
        },
        body: JSON.stringify({
          memberno: memberno,
          optionno: selected,
          amount: amountInput.value,
          price: price
        }),
      }).then((response)=>{
        if(!response.ok){
          throw new Error('Network response was not ok' + response.statusText);
        }
        return response.text();
      })
      .then((data) =>{
        if(!data){
          alert('결제주문이 실패하였습니다.');
          return false;
        }
        alert('결제주문이 성공하였습니다.');
        location.href = '/member/payment/order';
      })
      .catch((error) =>{
        alert('에러가 발생하였습니다. 관리자에게 연락하세요.');
      });
    }
  </script>
>>>>>>> Stashed changes
</div>


</html>