<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.mvc.admin.notice.NoticeDAOInter">
  <insert id="create" parameterType="dev.mvc.admin.notice.NoticeVO">
    INSERT INTO notice(noticeno, title, contents, rdate, memberno)
    VALUES(NOTICE_SEQ.nextval, #{title}, #{contents}, sysdate, #{memberno})
  </insert>

  <select id="list_all" resultType="dev.mvc.admin.notice.NoticeMemberVO">
    SELECT n.noticeno, n.title, n.contents, n.rdate, n.views, m.nickname
    FROM notice n, member m
    WHERE n.memberno = m.memberno
    ORDER BY n.rdate DESC
  </select>

  <!-- 검색된 레코드 수 -->
  <select id="list_search_count" resultType="int" parameterType="String">
    SELECT COUNT(*) as cnt
    FROM notice
    <if test="word != null and word != ''">
      WHERE UPPER(title) LIKE '%' || UPPER(#{word}) || '%' OR UPPER(contents) LIKE '%' || UPPER(#{word}) || '%'
    </if>
    ORDER BY rdate DESC
  </select>

  <select id="list_search_paging" resultType="dev.mvc.admin.notice.NoticeVO" parameterType="Map">
    SELECT noticeno, title, contents, rdate, views, memberno, r
    FROM (
        SELECT noticeno, title, contents, rdate, views, memberno, rownum as r
        FROM (
            SELECT noticeno, title, contents, rdate, views, memberno
            FROM notice
    <if test="word != null and word != ''">
              WHERE UPPER(title) LIKE '%' || UPPER(#{word}) || '%' OR UPPER(contents) LIKE '%' || UPPER(#{word}) || '%'  
            </if>
    ORDER BY rdate ASC
        )
    )
    WHERE r &gt; = #{start_num} AND r &lt; = #{end_num}
    <!-- WHERE r >= 1 AND r <= 3 -->
  </select>
  
  <select id="read" resultType="dev.mvc.admin.notice.NoticeVO" parameterType="Integer">
    SELECT noticeno, title, contents, rdate, views, memberno
    FROM notice
    WHERE noticeno = #{noticeno}
  </select>

  <update id="increased_views" parameterType="dev.mvc.admin.notice.NoticeVO">
    UPDATE notice
    SET views = views + 1
    WHERE noticeno = #{noticeno}
  </update>

  <update id="update" parameterType="dev.mvc.admin.notice.NoticeVO">
    UPDATE notice
    SET title = #{title}, contents = #{contents}
    WHERE noticeno = #{noticeno}
  </update>

  <delete id="delete" parameterType="Integer">
    DELETE FROM notice WHERE noticeno = #{notice}
  </delete>

</mapper>
