<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="dev.mvc.review.ReviewDAOInter">

  <select id="review_list" resultMap="reviewRead">
    SELECT r.reviewno, r.contents, r.grade, r.rdate, s.title, m.memberno, m.nickname, l.likes, l.hates
    FROM review r
    JOIN shoes s ON r.shoesno = s.shoesno
    JOIN member m ON r.memberno = m.memberno
    JOIN likes l ON r.reviewno = l.reviewno
    WHERE r.shoesno = #{shoesno}
  </select>

  <resultMap id="reviewRead" type="dev.mvc.shoes.ShoesAllVO">
    <association property="reviewVO" javaType="dev.mvc.review.ReviewVO">
      <id property="reviewno" column="reviewno" />
      <result property="contents" column="contents" />
      <result property="grade" column="grade" />
      <result property="rdate" column="rdate" />
    </association>

    <association property="shoesVO" javaType="dev.mvc.shoes.ShoesVO">
      <result property="title" column="title" />
    </association>

    <association property="memberVO" javaType="dev.mvc.member.MemberVO">
      <id property="memberno" column="memberno" />
      <result property="nickname" column="nickname" />
    </association>

    <association property="likesVO" javaType="dev.mvc.likes.LikesVO">
      <result property="likes" column="likes" />
      <result property="hates" column="hates" />
    </association>
  </resultMap>

  <select id="review_list_all" resultType="dev.mvc.review.ReviewVO">
    SELECT r.reviewno, r.contents, r.grade, r.rdate, m.nickname
    FROM review r
    JOIN member m ON r.memberno = m.memberno
    WHERE r.shoesno = #{shoesno}
    ORDER BY r.rdate DESC
  </select>

  <insert id="create" parameterType="dev.mvc.review.ReviewVO">
    INSERT INTO review(reviewno, contents, grade, rdate, shoesno, memberno)
    VALUES(review_seq.nextval, #{contents}, #{grade}, sysdate, #{shoesno}, #{memberno})
  </insert>

  <update id="update" parameterType="dev.mvc.review.ReviewVO">
    UPDATE review
    SET contents = #{contents}, grade = #{grade}
    WHERE reviewno = #{reviewno}
  </update>

  <delete id="delete" parameterType="Integer">
    DELETE FROM review
    WHERE reviewno = #{reviewno}
  </delete>
</mapper>